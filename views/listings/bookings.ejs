<% layout("/layouts/boilerplate.ejs") %>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/booking.css">
</head>
<body>
  <div class="bookings-list">
  <% if (!bookings || bookings.length === 0) { %>
    <p class="noBooking">You have no bookings!</p>
  <% } else { %>
    <% for (let i = 0; i < bookings.length; i += 2) { %>
      <div class="card-row">
        <% for (let j = 0; j < 2; j++) {
            const booking = bookings[i + j];
            if (booking) { %>
              <div class="booking-card">
                <div class="left-side">
                  <h3><%= booking.listing.title %></h3>
                  <p><strong>Check-in:</strong> <%= booking.checkInFormatted %></p>
                  <p><strong>Check-out:</strong> <%= booking.checkOutFormatted %></p>
                  <p><strong>Guests:</strong> <%= booking.guests %></p>
                  <p><strong>Order Date:</strong> 
                    <%= new Date(booking.createdAt).toLocaleString('en-IN', { 
                          timeZone: 'Asia/Kolkata',
                          year: 'numeric', 
                          month: 'short', 
                          day: 'numeric',
                          hour: '2-digit',
                          minute: '2-digit',
                          hour12: true
                    }) %> <b>(IST)</b>
                  </p>
                </div>
                <div class="right-side">
                  <% const checkInDate = new Date(booking.checkIn);
                     const checkOutDate = new Date(booking.checkOut);
                     const nights = (checkOutDate - checkInDate) / (1000 * 60 * 60 * 24);
                     const totalPrice = booking.listing.price * 1.18 * nights;
                  %>
                  <p><strong>Total Price:</strong> â‚¹<%= totalPrice.toLocaleString("en-IN") %> (<%= nights %> night<%= nights > 1 ? 's' : '' %>)</p>
                  <p><strong>Order ID:</strong> (<%= booking._id %>)</p>
                  <p><strong>Ordered By:</strong> <%= booking.user.username %></p>
                  <p><strong>User ID:</strong> (<%= booking.user._id %>)</p>
                  <div class="button-group">
                    <a href="/listings/<%= booking.listing._id %>" class="btn-visit">Visit Order</a>
                    <button onclick="openDeleteModal('<%= booking._id %>')" class="btn-delete">Delete</button>
      </div>
      </div>
    </div>
        <% } } %>
      </div>
    <% } %>
  <% } %>
</div>

<!-- Modal -->
<div id="booking-delete-modal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md text-center">
    <h2 class="text-xl font-semibold text-red-600">Confirm Deletion</h2>
    <p class="my-4 text-gray-700">Are you sure you want to delete this booking? This action cannot be undone.</p>
    <form id="delete-form" method="POST">
      <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-300 rounded mr-2 cancel_btn">Cancel</button>
      <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded yes_delBtn">Yes, Delete</button>
    </form>
  </div>
</div>
<script src="/js/booking.js"></script>
</body>
